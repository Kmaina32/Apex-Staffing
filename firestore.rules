rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check if a user is an admin
    function isAdmin(userId) {
      // List of admin UIDs - This should match your src/lib/admin.ts file
      let adminUids = [
        'u3gIVM3UDEXVJ2wt5NkCkr0kvvs2'
        // Add other admin UIDs here as strings
      ];
      return userId in adminUids;
    }

    // JOBS: Publicly readable, only admins can write
    match /jobs/{jobId} {
      allow read: if true;
      allow write: if isAdmin(request.auth.uid);
    }

    // USERS: Users can create their own profile and can only read/update their own data.
    match /users/{userId} {
      allow read, update: if request.auth != null && request.auth.uid == userId;
      allow create: if request.auth != null;
    }

    // APPLICATIONS: Users can create applications and can only read their own.
    match /applications/{applicationId} {
      allow read: if request.auth != null && request.auth.uid == resource.data.userId;
      allow create: if request.auth != null;
    }

    // SETTINGS: Publicly readable, only admins can write
    match /settings/{document=**} {
      allow read: if true;
      allow write: if isAdmin(request.auth.uid);
    }
  }
}
